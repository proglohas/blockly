<!DOCTYPE html>
<html>
<head>
<link rel="icon" type="image/png" href="favicon.png">
<link rel="shortcut icon" href="favicon.png">
<meta charset="utf-8">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<title>David's Blockly Lab</title>
<style>
/* 清爽淡藍的背景 */
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    padding: 30px;
    background-color: #F0F8FF; /* 淡藍色 (AliceBlue) */
    color: #333; /* 預設文字顏色 */
    margin: 0;
}

h1 {
    margin-bottom: 20px;
    color: #007bff; /* 標題顏色 */
    border-bottom: 2px solid #007bff; /* 標題下方加強分隔線 */
    padding-bottom: 10px;
    text-align: right; 
    display: flex;
    justify-content: space-between; /* 在左右兩邊放置元素 */
    align-items: flex-end; /* 將內容放在底部，與分隔線對齊 */
    flex-wrap: wrap; /* 避免在小螢幕上溢出 */
}

/* 確保主要的 "題目列表" 標題靠左 */
h1 span.title-main {
    text-align: left;
    flex-grow: 1; 
    color: #333; 
    font-size: 1.2em; 
}

/* 讓右側的資訊可以垂直排列 */
h1 div.title-info {
    text-align: right;
    display: flex;
    flex-direction: column; 
    align-items: flex-end; 
}

/* proglohas@gmail.com 的樣式 */
h1 span.title-email {
    color: #555; 
    font-size: 0.7em; 
    margin-bottom: 5px; 
}

/* 旭光高中練習用的樣式 */
h1 span.title-extra {
    color: #007bff; 
    font-size: 0.8em; 
    font-weight: normal; 
}

/* --- 分欄佈局核心樣式 (Grid 2 欄) --- */

#problemListContainer {
    display: grid;
    /* 預設兩欄佈局，每欄均分空間 */
    grid-template-columns: repeat(2, 1fr); 
    /* 設置欄與欄、行與行之間的間隔 */
    gap: 30px; 
}

/* 響應式調整 (讓小螢幕回到單欄) */
@media (max-width: 992px) {
    #problemListContainer {
        grid-template-columns: 1fr; /* 小螢幕恢復單欄 */
        gap: 0;
    }
    /* 恢復單欄時，在每個分類群組下方增加間距，使其分開 */
    .category-group {
        margin-bottom: 30px; 
    }
}

/* --- 內部元素樣式 --- */

/* 樣式化新增的分類標題 */
#problemListContainer h2 {
    color: #007bff; /* 使用主題色 */
    border-bottom: 2px solid #a3ccff; /* 淺藍色分隔線 */
    padding-bottom: 5px;
    margin-top: 0; /* 貼齊 category-group 頂部 */
    margin-bottom: 10px; /* 標題與列表框架之間的間隔 */
    font-size: 1.5em;
    font-weight: 600;
}

/* 列表框架樣式 (已加入固定高度和垂直捲軸) */
.problem-list-frame {
    background-color: #ffffff;
    /* 注意：padding 會讓實際可視內容區域變小 */
    padding: 10px 20px; 
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    border: 1px solid #e0e0e0;
    
    /* === 關鍵：固定高度與捲軸 === */
    height: 300px;        /* 設定固定高度 */
    overflow-y: auto;     /* 內容超出時顯示垂直捲軸 */
    /* ========================== */
}

/* 題目連結樣式 */
a {
    /* 由於父元素有 padding: 10px 20px，如果希望連結填滿寬度，可以設定 box-sizing */
    display: block;
    padding: 10px 0;
    margin: 0;
    text-decoration: none;
    color: #333; 
    transition: background-color 0.3s ease;
    /* 淡淡的分隔線 */
    border-bottom: 1px solid #e0e0e0; 
}
/* 移除每個框架內最後一個元素底部的分隔線 */
.problem-list-frame a:last-child {
    border-bottom: none;
}
a:hover {
    text-decoration: none;
    background-color: #e6f7ff; 
    color: #0056b3; 
}
</style>
</head>
<body>

<h1>
    <span class="title-main">題目列表</span>
    <div class="title-info">
        <span class="title-email">proglohas@gmail.com</span>
        <span class="title-extra">旭光高中 / 草屯國中 Blockly 練習網站</span>
    </div>
</h1>

<div id="problemListContainer">
    
    <div class="category-group">
        <h2>基礎題庫</h2>
        <div id="problemList_1" class="problem-list-frame">Loading...</div>
    </div>
    
    <div class="category-group">
        <h2>競賽題庫</h2>
        <div id="problemList_2" class="problem-list-frame">Loading...</div>
    </div>
    
    <div class="category-group">
        <h2>UVA 題庫</h2>
        <div id="problemList_3" class="problem-list-frame">Loading...</div>
    </div>
    
    <div class="category-group">
        <h2>第四類別</h2>
        <div id="problemList_4" class="problem-list-frame">Loading...</div>
    </div>

    <div class="category-group">
        <h2>不分類 / 其他</h2>
        <div id="problemList_0" class="problem-list-frame">Loading...</div>
    </div>

</div>

<script>
// 定義所有可能的分類 ID 及其對應的 HTML 容器 ID
const categories = {
    '1': 'problemList_1', // 基礎題庫
    '2': 'problemList_2', // 競賽題庫
    '3': 'problemList_3', // UVA 題庫
    '4': 'problemList_4', // 第四類別
    '0': 'problemList_0', // 不分類 / 其他 (預設)
};

// 處理初始化畫面，清除所有列表中的 "Loading..." 文字
Object.values(categories).forEach(id => {
    const el = document.getElementById(id);
    if (el) el.innerHTML = '';
});

// 使用 fetch 讀取 XML 檔案
fetch(`problemset.xml?ts=${Date.now()}`, { cache: "no-store" })
  .then(resp => resp.text())
  .then(str => (new DOMParser()).parseFromString(str,"text/xml"))
  .then(xml => {
    const problems = xml.getElementsByTagName('problem');

    for(let i=0;i<problems.length;i++){
      const problem = problems[i];
      // 讀取 ID 和 NAME
      const id = problem.getElementsByTagName('id')[0].textContent;
      const name = problem.getElementsByTagName('name')[0].textContent;
      
      // 讀取 cato 值
      let catoNode = problem.getElementsByTagName('cato')[0];
      // 如果 cato 存在，取其內容，否則預設為 '0'
      let cato = catoNode ? catoNode.textContent.trim() : '0';
      
      // 根據 cato 取得目標容器 ID
      const targetListId = categories[cato] || categories['0']; 
      const listDiv = document.getElementById(targetListId);
      
      if (!listDiv) {
          console.error(`找不到 ID 為 ${targetListId} 的容器，請檢查 HTML 結構。`);
          continue; 
      }
      
      const a = document.createElement('a');

      // 產生 5 碼亂數字串，用於避免快取
      const rand = Math.random().toString(36).substring(2, 7);

      // 設置連結屬性
      a.href = `train.html?id=${id}&v=${rand}`;
      a.target = "_blank";

      a.textContent = `${id} - ${name}`;
      listDiv.appendChild(a);
    }
  })
  .catch(err => { 
    console.error(err); 
    // 如果讀取失敗，所有容器都顯示錯誤訊息
    Object.values(categories).forEach(id => {
        const el = document.getElementById(id);
        if (el) el.textContent='讀取 XML 錯誤';
    });
});
</script>
</body>
</html>
