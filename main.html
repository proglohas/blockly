<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<title>Problem List</title>
<style>
/* 清爽淡藍的背景 */
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    padding: 30px;
    background-color: #F0F8FF; /* 淡藍色 (AliceBlue) */
    color: #333; /* 預設文字顏色 */
    margin: 0;
}

h1 {
    margin-bottom: 20px;
    color: #007bff; /* 標題顏色 */
    border-bottom: 2px solid #007bff; /* 標題下方加強分隔線 */
    padding-bottom: 10px;
    /* 讓 h1 內容靠右對齊 */
    text-align: right;
    /* 確保 h1 內容可以靠右對齊 (例如，如果內容是複合的) */
    display: flex;
    justify-content: space-between; /* 在左右兩邊放置元素 */
    align-items: flex-end; /* 將內容放在底部，與分隔線對齊 */
    flex-wrap: wrap; /* 避免在小螢幕上溢出 */
}

/* 確保主要的 "題目列表" 標題靠左 */
h1 span.title-main {
    text-align: left;
    flex-grow: 1; /* 讓它佔用剩餘空間 */
    color: #333; /* 可以選擇讓主標題使用深色以增加區分 */
    font-size: 1.2em; /* 稍微小一點 */
}

/* 讓右側的資訊可以垂直排列 */
h1 div.title-info {
    text-align: right;
    display: flex;
    flex-direction: column; /* 垂直堆疊子元素 */
    align-items: flex-end; /* 讓內部元素靠右對齊 */
}

/* proglohas@gmail.com 的樣式 */
h1 span.title-email {
    color: #555; /* 使用較柔和的顏色 */
    font-size: 0.7em; /* 更小的字體 */
    margin-bottom: 5px; /* 與下方的文字有一點間隔 */
}

/* 旭光高中練習用的樣式 */
h1 span.title-extra {
    color: #007bff; /* 使用主題色 */
    font-size: 0.8em; /* 練習用文字小一點 */
    font-weight: normal; /* 不加粗 */
}


#problemList {
    background-color: #ffffff; /* 列表區域使用白色背景以增加對比 */
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 輕微陰影 */
}

/* 題目連結樣式 & 統一高度的基礎樣式 */
a, .placeholder { /* 讓 a 和新的佔位符樣式統一 */
    display: block;
    padding: 10px 5px; /* <--- 讓 a/placeholder 決定高度和左右 padding */
    margin: 0;
    text-decoration: none;
    color: #333; /* 連結文字顏色 */
    transition: background-color 0.3s ease;
    border-bottom: 1px solid #e0e0e0; /* 淡淡的灰色分隔線 */
}

/* 測資連結的顏色調整 */
#problemList a {
    color: #007bff; /* 讓測資連結的顏色更明顯 */
    font-weight: normal;
}

/* 題目名稱（非連結）的特殊處理 */
#problemList a.problem-title {
    font-weight: bold;
    color: #333;
    cursor: default; /* 讓題目名稱沒有手型游標 */
}


/* 統一表格的單元格樣式 */
#problemList table td {
    vertical-align: top;
    padding: 0; /* <--- **關鍵**：將 padding 設為 0，讓 a/placeholder 決定間距 */
    overflow: hidden;
    text-align: left;
}

/* 移除最後一個元素底部的分隔線 - 必須針對 a/placeholder 處理 */
#problemList tr:last-child a,
#problemList tr:last-child .placeholder {
    border-bottom: none;
}

a:hover {
    text-decoration: none;
    background-color: #e6f7ff; /* 滑鼠移上時使用更淡的藍色背景 */
    color: #0056b3; /* 滑鼠移上時變深藍色 */
}
</style>
</head>
<body>

<h1>
    <span class="title-main">題目列表</span>
    <div class="title-info">
        <span class="title-email">proglohas@gmail.com</span>
        <span class="title-extra">旭光高中 / 草屯國中 練習網站</span>
    </div>
</h1>

<div id="problemList">Loading...</div>

<script>
fetch(`problemset.xml?ts=${Date.now()}`, { cache: "no-store" })
  .then(resp => resp.text())
  .then(str => (new DOMParser()).parseFromString(str,"text/xml"))
  .then(xml => {
    const listDiv = document.getElementById('problemList');
    listDiv.innerHTML = '';

    const table = document.createElement('table');
    table.style.width = '100%';
    table.style.borderCollapse = 'collapse';
    table.style.tableLayout = 'fixed'; // 固定欄寬
    listDiv.appendChild(table);

    // 統一設定欄寬
    const colgroup = document.createElement('colgroup');
    colgroup.innerHTML = `
        <col style="width: 30%;"> <col style="width: 14%;">
        <col style="width: 14%;">
        <col style="width: 14%;">
        <col style="width: 14%;">
        <col style="width: 14%;">
    `;
    table.appendChild(colgroup);

    const problems = xml.getElementsByTagName('problem');
    for(let i=0;i<problems.length;i++){
      const id = problems[i].getElementsByTagName('id')[0].textContent;
      const name = problems[i].getElementsByTagName('name')[0].textContent;
      const tsNode = problems[i].getElementsByTagName('ts')[0];
      const ts = tsNode ? parseInt(tsNode.textContent) : 1;

      const tr = document.createElement('tr');

      // 題目欄 - 使用 <a> 標籤來統一高度和分隔線
      const titleTd = document.createElement('td');
      titleTd.style.whiteSpace = 'nowrap';
      titleTd.style.textOverflow = 'ellipsis';
      
      const titleA = document.createElement('a');
      titleA.classList.add('problem-title'); // 用 class 區分題目和測資
      titleA.textContent = `${id} - ${name}`;
      titleTd.appendChild(titleA);
      tr.appendChild(titleTd);

      // 測資欄（最多 5 個）
      for(let j=1;j<=5;j++){
        const td = document.createElement('td');
        
        if(j <= ts){
          // 有測資：使用 <a> 連結
          const a = document.createElement('a');
          const rand = Math.random().toString(36).substring(2,7);
          a.href = `train.html?id=${id}_${String(j).padStart(2,'0')}&v=${rand}`;
          a.target = "_blank";
          a.textContent = `測資 ${j}`;
          td.appendChild(a);
        } else {
          // 沒有測資：使用一個佔位符元素來維持高度和分隔線樣式
          const placeholder = document.createElement('span');
          placeholder.classList.add('placeholder');
          placeholder.textContent = '\u00A0'; // 使用不換行空格佔位
          placeholder.style.backgroundColor = 'transparent'; // 確保背景是透明的
          placeholder.style.color = '#ccc'; // 可以讓佔位符的文字/空格隱藏或呈現灰色
          placeholder.style.cursor = 'default';
          td.appendChild(placeholder);
        }
        tr.appendChild(td);
      }

      table.appendChild(tr);
    }
  })
  .catch(err => {
    console.error(err);
    document.getElementById('problemList').textContent='讀取錯誤';
  });
</script>
</body>
</html>
